import{r as e,a as r,g as s}from"./assets/react.rqAYhSLv.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&r(e)})).observe(document,{childList:!0,subtree:!0})}function r(e){if(e.ep)return;e.ep=!0;const r=function(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?r.credentials="include":"anonymous"===e.crossOrigin?r.credentials="omit":r.credentials="same-origin",r}(e);fetch(e.href,r)}}();var n,o,t={exports:{}},i={};var a,l=(o||(o=1,t.exports=function(){if(n)return i;n=1;var r=e(),s=Symbol.for("react.element"),o=Symbol.for("react.fragment"),t=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,r,n){var o,i={},c=null,d=null;for(o in void 0!==n&&(c=""+n),void 0!==r.key&&(c=""+r.key),void 0!==r.ref&&(d=r.ref),r)t.call(r,o)&&!l.hasOwnProperty(o)&&(i[o]=r[o]);if(e&&e.defaultProps)for(o in r=e.defaultProps)void 0===i[o]&&(i[o]=r[o]);return{$$typeof:s,type:e,key:c,ref:d,props:i,_owner:a.current}}return i.Fragment=o,i.jsx=c,i.jsxs=c,i}()),t.exports),c=e(),d={};const u=s(function(){if(a)return d;a=1;var e=r();return d.createRoot=e.createRoot,d.hydrateRoot=e.hydrateRoot,d}());function p(e,r,s={}){const n={timestamp:(new Date).toISOString(),level:e,message:r,...s};"debug"===e?console.debug(JSON.stringify(n)):"error"===e?console.error(JSON.stringify(n)):"warn"===e?console.warn(JSON.stringify(n)):console.log(JSON.stringify(n))}const m=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"],g=()=>{const[e,r]=c.useState(!1),[s,n]=c.useState([]),[o,t]=c.useState({autoSubmit:!1,fieldMapping:{},validationRules:{}}),[i,a]=c.useState(null),[d,u]=c.useState(0),[g,f]=c.useState(null),[h,v]=c.useState([]),[y,x]=c.useState(!1),j=c.useCallback((e=>{e.preventDefault(),p("debug","Drag enter event"),r(!0)}),[]),S=c.useCallback((e=>{e.preventDefault(),r(!1)}),[]),w=c.useCallback((e=>{e.preventDefault()}),[]),[b,N]=c.useState(null),[E,O]=c.useState({loading:!1,progress:0,success:!1,error:null}),R=async(e,r={})=>{var s,n;if(p("debug","Sending message",{type:e,data:r}),!(null==(n=null==(s=window.chrome)?void 0:s.runtime)?void 0:n.sendMessage))return p("warn","Chrome runtime API not available - running in standalone mode"),{success:!1,error:"Chrome runtime unavailable"};try{const s=await Promise.race([new Promise((s=>{chrome.runtime.sendMessage({type:e,...r},s)})),new Promise(((e,r)=>{setTimeout((()=>r(new Error("Timeout waiting for response"))),5e3)}))]);if(!s)throw new Error("Empty response from background script");if(p("debug","Received response",{response:s}),s.error)throw new Error(s.error);return s}catch(o){throw p("error","Message failed",{type:e,error:o}),o}};c.useEffect((()=>{var e,r;const s=(e,r,s)=>("LLM_RESPONSE"===e.type?(p("info","Received LLM response",{data:e.data}),a(e.data),u(e.processingTime||0)):"BACKGROUND_ERROR"===e.type?(p("error","Background error",{error:e.error}),f(e.error)):"FORM_FILLING_COMPLETE"===e.type&&(p("info","Form filling completed",{processingTime:e.processingTime}),u(e.processingTime||0)),!0);return(null==(r=null==(e=window.chrome)?void 0:e.runtime)?void 0:r.onMessage)?(chrome.runtime.onMessage.addListener(s),()=>chrome.runtime.onMessage.removeListener(s)):(p("warn","Chrome runtime API not available - running in standalone mode"),()=>{})}),[]);const L=c.useCallback((async e=>{e.preventDefault(),p("debug","Drag leave event"),r(!1),p("debug","Drop event triggered"),N(null),O({loading:!1,progress:0,success:!1,error:null});const s=Array.from(e.dataTransfer.files),o=s.filter((e=>!m.includes(e.type)||e.size>10485760));if(o.length>0){const e="Invalid files detected. Only Excel files (.xlsx, .xls) under 10MB are allowed.";return p("error","Invalid files detected",{invalidFiles:o}),void N(e)}p("info","Files accepted for processing",{files:s.map((e=>e.name))}),n(s);try{O({loading:!0,progress:0,success:!1,error:null});const e=s.map((e=>new Promise((r=>{const s=new FileReader;s.onload=s=>r({name:e.name,type:e.type,size:e.size,content:s.target.result}),s.readAsDataURL(e)})))),r=await Promise.all(e),n=await R("PROCESS_FILES",{files:r});if(p("info",{response:n}),!(null==n?void 0:n.success))throw new Error((null==n?void 0:n.error)||"File processing failed");O({loading:!1,progress:100,success:!0,error:null})}catch(t){p("error","File upload failed",{error:t}),O({loading:!1,progress:0,success:!1,error:t.message})}}),[R]);return l.jsxs("div",{className:"popup-container",children:[l.jsx("h1",{children:"Extension Popup"}),l.jsx("div",{className:"drop-zone "+(e?"dragging":""),onDragEnter:j,onDragLeave:S,onDragOver:w,onDrop:L,children:e?l.jsx("p",{children:"Drop files here"}):l.jsx("p",{children:"Drag and drop files here"})}),b&&l.jsx("div",{className:"error-message",children:b}),s.length>0&&l.jsxs("div",{className:"file-list",children:[l.jsx("h3",{children:"Dropped Files:"}),l.jsx("ul",{children:s.map(((e,r)=>l.jsxs("li",{children:[e.name,E.loading&&l.jsx("span",{className:"upload-status",children:" (Uploading...)"}),E.success&&l.jsx("span",{className:"upload-success",children:" ✓"}),E.error&&l.jsx("span",{className:"upload-error",children:" ✗"})]},r)))}),E.loading&&l.jsxs("div",{className:"upload-progress",children:[l.jsx("progress",{value:E.progress,max:"100"}),l.jsxs("span",{children:[E.progress,"%"]})]}),l.jsxs("div",{className:"form-config-section",children:[l.jsx("h3",{children:"Form Configuration"}),l.jsx("div",{className:"config-option",children:l.jsxs("label",{children:[l.jsx("input",{type:"checkbox",checked:o.autoSubmit,onChange:e=>{p("debug","Form config changed",{autoSubmit:e.target.checked}),t({...o,autoSubmit:e.target.checked})}}),"Auto-submit after filling"]})})]}),i&&l.jsxs("div",{className:"llm-response",children:[l.jsx("h3",{children:"LLM Analysis"}),l.jsx("pre",{children:JSON.stringify(i,null,2)})]}),d>0&&l.jsxs("div",{className:"performance-metrics",children:[l.jsx("h3",{children:"Performance"}),l.jsxs("p",{children:["Processing time: ",d,"ms"]})]}),g&&l.jsxs("div",{className:"error-message",children:[l.jsx("h3",{children:"Background Error"}),l.jsx("p",{children:g})]})]})]})};(async function(){u.createRoot(document.getElementById("root")).render(l.jsx(g,{}))})().catch(console.error);
