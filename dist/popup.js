import{r as e,a as r,g as s}from"./assets/react.rqAYhSLv.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&r(e)})).observe(document,{childList:!0,subtree:!0})}function r(e){if(e.ep)return;e.ep=!0;const r=function(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?r.credentials="include":"anonymous"===e.crossOrigin?r.credentials="omit":r.credentials="same-origin",r}(e);fetch(e.href,r)}}();var o,n,i={exports:{}},t={};var l,a=(n||(n=1,i.exports=function(){if(o)return t;o=1;var r=e(),s=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function c(e,r,o){var n,t={},c=null,d=null;for(n in void 0!==o&&(c=""+o),void 0!==r.key&&(c=""+r.key),void 0!==r.ref&&(d=r.ref),r)i.call(r,n)&&!a.hasOwnProperty(n)&&(t[n]=r[n]);if(e&&e.defaultProps)for(n in r=e.defaultProps)void 0===t[n]&&(t[n]=r[n]);return{$$typeof:s,type:e,key:c,ref:d,props:t,_owner:l.current}}return t.Fragment=n,t.jsx=c,t.jsxs=c,t}()),i.exports),c=e(),d={};const u=s(function(){if(l)return d;l=1;var e=r();return d.createRoot=e.createRoot,d.hydrateRoot=e.hydrateRoot,d}());function f(e,r,s={}){const o={timestamp:(new Date).toISOString(),level:e,message:r,...s};"debug"===e?console.debug(JSON.stringify(o)):"error"===e?console.error(JSON.stringify(o)):"warn"===e?console.warn(JSON.stringify(o)):console.log(JSON.stringify(o))}const m=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"],p=()=>{const[e,r]=c.useState(!1),[s,o]=c.useState([]),[n,i]=c.useState({autoSubmit:!1,fieldMapping:{},validationRules:{}}),[t,l]=c.useState(null),[d,u]=c.useState(0),[p,g]=c.useState(null),[h,v]=c.useState([]),[x,j]=c.useState(!1),[y,S]=c.useState({success:!1,fieldsProcessed:0,errors:[]}),b=c.useCallback((e=>{e.preventDefault(),f("debug","Drag enter event"),r(!0)}),[]),N=c.useCallback((e=>{e.preventDefault(),r(!1)}),[]),O=c.useCallback((e=>{e.preventDefault()}),[]),[F,P]=c.useState(null),[E,L]=c.useState({loading:!1,progress:0,success:!1,error:null}),R=(e,r={})=>{var s,o;if(f("debug","Sending message",{type:e,data:r}),!(null==(o=null==(s=window.chrome)?void 0:s.runtime)?void 0:o.sendMessage))return f("warn","Chrome runtime API not available - running in standalone mode"),{success:!1,error:"Chrome runtime unavailable"};"PROCESS_FILES"===e&&j(!0),window.chrome.runtime.sendMessage({type:e,...r},(function(e){f("info","Received response from background",{response:e});try{const r="string"==typeof e?JSON.parse(e):e;if(r&&r.success){if(L({loading:!1,progress:100,success:!0,error:null}),r.results&&r.results.length>0){const e=r.results[0].data;e&&e.fields&&(v(e.fields),f("info","Sending form data to content script",{fields:e.fields}),chrome.tabs.query({active:!0,currentWindow:!0},(function(r){r&&r.length>0?chrome.tabs.sendMessage(r[0].id,{type:"FILL_FORM",data:{fields:e.fields,autoSubmit:n.autoSubmit}},(function(e){f("info","Form filling response",{fillResponse:e}),j(!1)})):(f("error","No active tab found"),g("No active tab found to fill form"),j(!1))})))}}else r&&r.error&&(f("error","Error in response",{error:r.error}),L({loading:!1,progress:0,success:!1,error:r.error}),j(!1))}catch(r){f("error","Error processing response",{error:r,response:e}),L({loading:!1,progress:0,success:!1,error:"Failed to process response"}),j(!1)}}))};c.useEffect((()=>{var e,r;const s=e=>("LLM_RESPONSE"===e.type?(f("info","Received LLM response",{data:e.data}),l(e.data),u(e.processingTime||0)):"BACKGROUND_ERROR"===e.type?(f("error","Background error",{error:e.error}),g(e.error),j(!1),S((r=>({...r,success:!1,errors:[...r.errors,e.error]})))):"FORM_FILLING_COMPLETE"===e.type&&(f("info","Form filling completed",{processingTime:e.processingTime,success:e.success,fieldsProcessed:e.fieldsProcessed,errors:e.errors}),u(e.processingTime||0),j(!1),S({success:e.success,fieldsProcessed:e.fieldsProcessed||0,errors:e.errors||[]})),!0);return(null==(r=null==(e=window.chrome)?void 0:e.runtime)?void 0:r.onMessage)?(chrome.runtime.onMessage.addListener(s),()=>chrome.runtime.onMessage.removeListener(s)):(f("warn","Chrome runtime API not available - running in standalone mode"),()=>{})}),[]);const _=c.useCallback((async e=>{e.preventDefault(),f("debug","Drag leave event"),r(!1),f("debug","Drop event triggered"),P(null),L({loading:!1,progress:0,success:!1,error:null});const s=Array.from(e.dataTransfer.files),n=s.filter((e=>!m.includes(e.type)||e.size>10485760));if(n.length>0){const e="Invalid files detected. Only Excel files (.xlsx, .xls) under 10MB are allowed.";return f("error","Invalid files detected",{invalidFiles:n}),void P(e)}f("info","Files accepted for processing",{files:s.map((e=>e.name))}),o(s);try{L({loading:!0,progress:0,success:!1,error:null});const e=s.map((e=>new Promise((r=>{const s=new FileReader;s.onload=s=>r({name:e.name,type:e.type,size:e.size,content:s.target.result}),s.readAsDataURL(e)})))),r=await Promise.all(e);R("PROCESS_FILES",{files:r})}catch(i){f("error","File upload failed",{error:i}),L({loading:!1,progress:0,success:!1,error:i.message})}}),[R]);return a.jsxs("div",{className:"popup-container",children:[a.jsx("h1",{children:"Extension Popup"}),x&&a.jsxs("div",{className:"processing-indicator",children:[a.jsx("p",{children:"Processing form data..."}),a.jsx("div",{className:"spinner"})]}),a.jsx("div",{className:"drop-zone "+(e?"dragging":""),onDragEnter:b,onDragLeave:N,onDragOver:O,onDrop:_,children:e?a.jsx("p",{children:"Drop files here"}):a.jsx("p",{children:"Drag and drop files here"})}),F&&a.jsx("div",{className:"error-message",children:F}),s.length>0&&a.jsxs("div",{className:"file-list",children:[a.jsx("h3",{children:"Dropped Files:"}),a.jsx("ul",{children:s.map(((e,r)=>a.jsxs("li",{children:[e.name,E.loading&&a.jsx("span",{className:"upload-status",children:" (Uploading...)"}),E.success&&a.jsx("span",{className:"upload-success",children:" ✓"}),E.error&&a.jsx("span",{className:"upload-error",children:" ✗"})]},r)))}),E.loading&&a.jsxs("div",{className:"upload-progress",children:[a.jsx("progress",{value:E.progress,max:"100"}),a.jsxs("span",{children:[E.progress,"%"]})]}),a.jsxs("div",{className:"form-config-section",children:[a.jsx("h3",{children:"Form Configuration"}),a.jsx("div",{className:"config-option",children:a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",checked:n.autoSubmit,onChange:e=>{f("debug","Form config changed",{autoSubmit:e.target.checked}),i({...n,autoSubmit:e.target.checked})}}),"Auto-submit after filling"]})}),h.length>0&&!x&&a.jsx("button",{className:"fill-form-button",onClick:()=>{j(!0),S({success:!1,fieldsProcessed:0,errors:[]}),f("info","Manually triggering form fill"),chrome.tabs.query({active:!0,currentWindow:!0},(function(e){e&&e.length>0?chrome.tabs.sendMessage(e[0].id,{type:"FILL_FORM",data:{fields:h,autoSubmit:n.autoSubmit}}):(f("error","No active tab found"),g("No active tab found to fill form"),j(!1))}))},children:"Fill Form Now"})]}),h.length>0&&a.jsxs("div",{className:"form-fields",children:[a.jsx("h3",{children:"Form Fields to Fill"}),a.jsx("ul",{children:h.map(((e,r)=>a.jsxs("li",{children:[a.jsx("strong",{children:e.name}),": ",e.value]},r)))})]}),y.fieldsProcessed>0&&a.jsxs("div",{className:"form-fill-status "+(y.success?"success":"error"),children:[a.jsx("h3",{children:"Form Fill Status"}),a.jsxs("p",{children:[a.jsx("strong",{children:"Status:"})," ",y.success?"Success":"Error"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Fields Processed:"})," ",y.fieldsProcessed]}),y.errors&&y.errors.length>0&&a.jsxs("div",{className:"fill-errors",children:[a.jsx("strong",{children:"Errors:"}),a.jsx("ul",{children:y.errors.map(((e,r)=>a.jsx("li",{children:e},r)))})]})]}),t&&a.jsxs("div",{className:"llm-response",children:[a.jsx("h3",{children:"LLM Analysis"}),a.jsx("pre",{children:JSON.stringify(t,null,2)})]}),d>0&&a.jsxs("div",{className:"performance-metrics",children:[a.jsx("h3",{children:"Performance"}),a.jsxs("p",{children:["Processing time: ",d,"ms"]})]}),p&&a.jsxs("div",{className:"error-message",children:[a.jsx("h3",{children:"Background Error"}),a.jsx("p",{children:p})]})]})]})};(async function(){u.createRoot(document.getElementById("root")).render(a.jsx(p,{}))})().catch(console.error);
